webpackJsonp(["app/js/oauth2/create/index"],{0:function(e,t){e.exports=jQuery},"04e12e97a64b943320e3":function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),o=a("e104a65d9efb9ac573bc"),c=a("b334fd7e4c5a19234db2"),i=r(c),d=a("0fcd3a355c9fe74234e3"),u=a("5eb223de522186da1dd9"),l=r(u),h=function(){function e(){n(this,e),this.$form=$("#third-party-create-account-form"),this.$btn=$(".js-submit-btn"),this.validator=null,this.captchaToken=null,this.smsToken=null,this.init()}return s(e,[{key:"init",value:function(){this.initCaptchaCode(),this.initValidator(),this.changeCaptchaCode(),this.sendMessage(),this.submitForm(),this.removeSmsErrorTip()}},{key:"initValidator",value:function(){var e=this,t=$(".js-sms-send");this.validator=this.$form.validate({rules:{username:{required:!0,byte_minlength:4,byte_maxlength:18,nickname:!0,chinese_alphanumeric:!0,es_remote:{type:"get"}},password:{required:!0,minlength:5,maxlength:20},confirmPassword:{required:!0,equalTo:"#password"},captcha_code:{required:!0,alphanumeric:!0,captcha_checkout:{callback:function(a){if(!a){t.attr("disabled",!0);var r=e.initCaptchaCode();return e.captchaToken=r,e.captchaToken}t.removeAttr("disabled")}}},sms_code:{required:!0,unsigned_integer:!0,rangelength:[6,6]}},messages:{sms_code:{required:Translator.trans("site.captcha_code.required"),rangelength:Translator.trans("validate.sms_code.message")}}}),$.validator.addMethod("captcha_checkout",function(t,a,r){$(a);if(t.length<5)return void($.validator.messages.captcha_checkout=Translator.trans("oauth.captcha_code_length_tip"));var n=r.data?r.data:{phrase:t},s=r.callback?r.callback:null,o=0,c={captchaToken:e.captchaToken};return l.default.captcha.validate({data:n,params:c,async:!1,promise:!1}).done(function(e){"success"===e.status?o=!0:"expired"===e.status?(o=!1,$.validator.messages.captcha_checkout=Translator.trans("oauth.captcha_code_expired_tip")):(o=!1,$.validator.messages.captcha_checkout=Translator.trans("oauth.captcha_code_error_tip")),s&&s(o)}).error(function(e){}),this.optional(a)||o},Translator.trans("validate.captcha_checkout.message"))}},{key:"initCaptchaCode",value:function(){var e=this,t=$("#getcode_num");if(t.length)return l.default.captcha.get({async:!1,promise:!1}).done(function(a){t.attr("src",a.image),e.captchaToken=a.captchaToken}).error(function(e){}),this.captchaToken}},{key:"sendMessage",value:function(){var e=this,t=$(".js-sms-send"),a=$("#captcha_code");t.length&&t.click(function(t){var r=$(t.target),n={type:"register",mobile:$(".js-account").html(),captchaToken:e.captchaToken,phrase:a.val()};l.default.sms.send({data:n}).then(function(t){e.smsToken=t.smsToken,(0,d.countDown)(120)}).catch(function(t){switch(t.responseJSON.error.code){case 30001:(0,i.default)("danger",Translator.trans("oauth.refresh.captcha_code_tip")),a.val(""),r.attr("disabled",!0),e.initCaptchaCode();break;case 30002:(0,i.default)("danger",Translator.trans("oauth.send.error_message_tip"));break;case 30003:(0,i.default)("danger",Translator.trans("admin.site.cloude_sms_enable_hint"));break;default:(0,i.default)("danger",Translator.trans("site.data.get_sms_code_failure_hint"))}})})}},{key:"changeCaptchaCode",value:function(){var e=this,t=$("#getcode_num");t.length&&t.click(function(){e.initCaptchaCode()})}},{key:"submitForm",value:function(){var e=this;this.$btn.click(function(t){var a=$(t.target);if(e.validator.form()){a.button("loading");var r={nickname:$("#username").val(),password:$("#password").val(),mobile:$(".js-account").html(),smsToken:e.smsToken,smsCode:$("#sms-code").val(),captchaToken:e.captchaToken,phrase:$("#captcha_code").val()},n=Translator.trans("oauth.send.sms_code_error_tip");$.post(a.data("url"),r,function(e){a.button("reset"),1===e.success?window.location.href=e.url:$(".js-password-error").length||a.prev().addClass("has-error").append('<p id="password-error" class="form-error-message js-password-error">'+n+"</p>")}).error(function(e){a.button("reset"),429===e.status?(0,i.default)("danger",Translator.trans("oauth.register.time_limit")):(0,i.default)("danger",Translator.trans("oauth.register.error_message"))})}}),(0,o.enterSubmit)(this.$form,this.$btn)}},{key:"removeSmsErrorTip",value:function(){$("#sms-code").focus(function(){var e=$(".js-password-error");e.length&&e.remove()})}}]),e}();t.default=h},"0fcd3a355c9fe74234e3":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countDown=void 0;var r=a("b334fd7e4c5a19234db2"),n=function(e){return e&&e.__esModule?e:{default:e}}(r),s=$(".js-time-left"),o=$(".js-sms-send"),c=$(".js-fetch-btn-text"),i=(t.countDown=function(e){s.html(e),c.html(Translator.trans("site.data.get_sms_code_again_btn")),(0,n.default)("success",Translator.trans("site.data.get_sms_code_success_hint")),i()},function e(){var t=s.text();s.html(t-1),t-1>0?(o.attr("disabled",!0),setTimeout(e,1e3)):(s.html(""),c.html(Translator.trans("oauth.send.validate_message")),o.removeAttr("disabled"))})},"1d43a4025aadc22df310":function(e,t,a){"use strict";var r=a("04e12e97a64b943320e3");new(function(e){return e&&e.__esModule?e:{default:e}}(r).default)},e104a65d9efb9ac573bc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){e.keypress(function(e){13==e.which&&(t.trigger("click"),e.preventDefault())})};t.enterSubmit=r}},["1d43a4025aadc22df310"]);