webpackJsonp(["app/js/activity-manage/download/index"],{fbf0b6283b62b602eb6b:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),r=a("eca7a2561fa47d3f75f6"),s=i(r),o=a("b334fd7e4c5a19234db2"),d=(i(o),a("f324dbdea53170d5000f")),m=function(){function e(){n(this,e),this.$form=$("#step2-form"),this.validator2=null,this.firstName=$("#title").val(),this.initStep2Form(),this.bindEvent(),this.initFileChooser()}return l(e,[{key:"initStep2Form",value:function(){var e=this.$form.validate({rules:{title:{required:!0,maxlength:50,trim:!0,course_title:!0},link:"url",materials:"required"},messages:{link:Translator.trans("activity.download_manage.link_error_hint"),materials:Translator.trans("activity.download_manage.materials_error_hint")}});this.$form.data("validator",e)}},{key:"bindEvent",value:function(){var e=this;this.$form.on("click",".js-btn-delete",function(t){return e.itemDelete(t)}),this.$form.on("click",".js-video-import",function(){return e.videoImport(!1)}),this.$form.on("click",".js-add-file-list",function(){return e.addFileBtn(!0)}),this.$form.on("blur","#title",function(t){return e.titleChange(t)})}},{key:"itemDelete",value:function(e){var t=$(e.currentTarget).closest("li"),a=t.data("id"),i=this.isEmpty($("#materials").val())?{}:JSON.parse($("#materials").val());i&&i[a]&&(delete i[a],$("#materials").val(JSON.stringify(i))),t.siblings("li").length<=0&&$("#materials").val(null),t.remove()}},{key:"videoImport",value:function(e){this.addFile(e)}},{key:"addFileBtn",value:function(e){this.addFile(e)}},{key:"initFileChooser",value:function(){var e=this,t=function(t){$("input[name=media]").val(JSON.stringify(t)),(0,d.chooserUiOpen)(),e.addFile(!1),e.firstName?$("#title").val(e.firstName):$("#title").val(""),$(".js-current-file").text(t.name)},a=new s.default;a.on("select",t)}},{key:"titleChange",value:function(e){var t=$(e.currentTarget);this.firstName=t.val()}},{key:"isEmpty",value:function(e){return null==e||""==e||void 0==e||0==Object.keys(e).length}},{key:"addFile",value:function(e){if($(".js-success-redmine").hide(),this.isEmpty($("#media").val())&&$("#step2-form").data("validator")&&$("#step2-form").data("validator").valid()&&$("#link").val().length>0){e||$("#verifyLink").val($("#link").val());var t={source:"link",id:$("#verifyLink").val(),name:$("#verifyLink").val(),link:$("#verifyLink").val(),summary:$("#file-summary").val(),size:0};$(".js-current-file").text($("#verifyLink").val()),$("#media").val(JSON.stringify(t))}var a=this.isEmpty($("#media").val())?{}:JSON.parse($("#media").val()),i=this.isEmpty($("#materials").val())?{}:JSON.parse($("#materials").val());if(!this.isEmpty(i)&&i[a.id])return $(".js-danger-redmine").text(Translator.trans("activity.download_manage.materials_exist_error_hint")).show(),setTimeout(function(){$(".js-danger-redmine").slideUp()},3e3),$(".js-current-file").text(""),$("#media").val(null),void(a=null);if(e){if(e&&this.isEmpty(a))return $(".js-danger-redmine").text(Translator.trans("activity.download_manage.materials_error_hint")).show(),$(".js-current-file").text(""),void setTimeout(function(){$(".js-danger-redmine").slideUp()},3e3);$(".js-current-file").text(""),a.summary=$("#file-summary").val(),i[a.id]=a,$("#materials").val(JSON.stringify(i)),$("#media").val(null),$("#link").val(null),$("#file-summary").val(null),this.firstName||(this.firstName=a.name,$("#title").val(a.name));var n="";n=a.link?'\n    <li class="download-item " data-id="'+a.link+'">\n        <a class="gray-primary" href="'+a.link+'" target="_blank">'+a.name+'</a>\n        <a class="gray-primary phm btn-delete  js-btn-delete"  href="javascript:;"  data-url="" data-toggle="tooltip" data-placement="top" title="'+Translator.trans("activity.download_manage.materials_delete_btn")+'"><i class="es-icon es-icon-delete"></i></a>\n        <span class="glyphicon glyphicon-new-window text-muted text-sm" title="'+Translator.trans("activity.download_manage.materials_delete_btn")+'"></span>\n    </li>\n  ':'\n    <li class="download-item " data-id="'+a.id+'">\n      <a class="gray-primary" href="/materiallib/'+a.id+'/download">'+a.name+'</a>\n      <a class="gray-primary phm  btn-delete js-btn-delete" href="javascript:;"  data-url="" data-toggle="tooltip" data-placement="top" title="'+Translator.trans("activity.download_manage.materials_delete_btn")+'"><i class="es-icon es-icon-delete"></i></a>\n    </li>\n  ',$("#material-list").append(n),$('[data-toggle="tooltip"]').tooltip(),$(".file-browser-item").removeClass("active"),$(".js-danger-redmine").hide(),$(".js-success-redmine").text(Translator.trans("activity.download_manage.materials_add_success_hint")).show(),setTimeout(function(){$(".js-success-redmine").slideUp()},3e3),$(".jq-validate-error:visible").length>0&&$("#step2-form").data("validator").form()}}}]),e}();t.default=m},0:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n=a("fbf0b6283b62b602eb6b"),l=i(n);new l.default}});