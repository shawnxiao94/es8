webpackJsonp(["app/js/course-manage/marketing/index"],{"1dd3c6f89866f052a53c":function(e,a,i){"use strict";function t(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(a,i,t){return i&&e(a.prototype,i),t&&e(a,t),a}}();new(function(){function e(){t(this,e),this.validator=null,this.init()}return n(e,[{key:"init",value:function(){this.initDatePicker("#expiryStartDate"),this.initDatePicker("#expiryEndDate"),this.initDatePicker("#deadline"),this.initValidator(),this.initExpiryMode(),this.initenableBuyExpiry(),this.taskPriceSetting(),this.checkBoxChange(),this.initDatetimepicker(),this.setService()}},{key:"setService",value:function(){$(".js-service-item").click(function(e){var a=$(e.currentTarget),i=$("#course_services").val(),t=void 0;t=i?JSON.parse(i):[],a.hasClass("label-primary")?(a.removeClass("label-primary").addClass("label-default"),t.splice(t.indexOf(a.data("code")),1)):(a.removeClass("label-default").addClass("label-primary"),t.push(a.data("code"))),$("#course_services").val(JSON.stringify(t))})}},{key:"initDatetimepicker",value:function(){var e=this;$('input[name="buyExpiryTime"]').datetimepicker({format:"yyyy-mm-dd",language:document.documentElement.lang,minView:2,autoclose:!0}).on("hide",function(){e.validator&&e.validator.form()}),this.updateDatetimepicker()}},{key:"initValidator",value:function(){var e=this,a=$("#course-marketing-form");$(".js-task-price-setting").perfectScrollbar(),this.validator=a.validate({groups:{date:"expiryStartDate expiryEndDate"},rules:{originPrice:{required:function(){return 0==$("[name=isFree]:checked").val()},positive_currency:function(){return 0==$("[name=isFree]:checked").val()}},watchLimit:{digits:!0},rewardPoint:{required:!0,max:1e5,unsigned_integer:!0},taskRewardPoint:{required:!0,max:1e5,unsigned_integer:!0}},messages:{buyExpiryTime:{required:Translator.trans("course.manage.buy_expiry_time_error_hint"),date:Translator.trans("course.manage.buy_expiry_time_error_hint")},rewardPoint:{required:Translator.trans("请输入教学计划奖励积分"),max:Translator.trans("请输入0-100000的整数")},taskRewardPoint:{required:Translator.trans("请输入计划任务奖励积分"),max:Translator.trans("请输入0-100000的整数")}}}),$("#course-submit").click(function(i){e.validator&&e.validator.form()&&($(i.currentTarget).button("loading"),a.submit())})}},{key:"updateDatetimepicker",value:function(){$('input[name="buyExpiryTime"]').datetimepicker("setStartDate",new Date(Date.now())),$('input[name="buyExpiryTime"]').datetimepicker("setEndDate",new Date(Date.now()+31536e7))}},{key:"checkBoxChange",value:function(){var e=this;$('input[name="buyable"]').on("change",function(a){0==$('input[name="buyable"]:checked').val()?($(".js-course-add-close-show").removeClass("hidden"),$(".js-course-add-open-show").addClass("hidden")):($(".js-course-add-close-show").addClass("hidden"),$(".js-course-add-open-show").removeClass("hidden")),e.initenableBuyExpiry()}),$('input[name="enableBuyExpiryTime"]').on("change",function(a){0==$('input[name="enableBuyExpiryTime"]:checked').val()?$("#buyExpiryTime").addClass("hidden"):($("#buyExpiryTime").removeClass("hidden"),e.updateDatetimepicker()),e.initenableBuyExpiry()}),$('input[name="deadlineType"]').on("change",function(a){"end_date"==$('input[name="deadlineType"]:checked').val()?($("#deadlineType-date").removeClass("hidden"),$("#deadlineType-days").addClass("hidden")):($("#deadlineType-date").addClass("hidden"),$("#deadlineType-days").removeClass("hidden")),e.initExpiryMode()}),$('input[name="expiryMode"]').on("change",function(a){"date"==$('input[name="expiryMode"]:checked').val()?($("#expiry-days").removeClass("hidden").addClass("hidden"),$("#expiry-date").removeClass("hidden")):"days"==$('input[name="expiryMode"]:checked').val()?($("#expiry-date").removeClass("hidden").addClass("hidden"),$("#expiry-days").removeClass("hidden")):($("#expiry-date").removeClass("hidden").addClass("hidden"),$("#expiry-days").removeClass("hidden").addClass("hidden")),e.initExpiryMode()}),$('input[name="isFree"]').on("change",function(e){0==$('input[name="isFree"]:checked').val()?$(".js-is-free").removeClass("hidden"):$(".js-is-free").addClass("hidden")}),$('input[name="tryLookable"]').on("change",function(e){1==$('input[name="tryLookable"]:checked').val()?$(".js-enable-try-look").removeClass("hidden"):$(".js-enable-try-look").addClass("hidden")}),$('input[name="showServices"]').on("change",function(e){1==$('input[name="showServices"]:checked').val()?$(".js-services").removeClass("hidden"):$(".js-services").addClass("hidden")})}},{key:"taskPriceSetting",value:function(){$(".js-task-price-setting").on("click","li",function(e){var a=$(this).toggleClass("open"),i=a.find("input");i.prop("checked",!i.is(":checked"))}),$(".js-task-price-setting").on("click","input",function(e){e.stopPropagation(),$(this).closest("li").toggleClass("open")})}},{key:"initDatePicker",value:function(e){var a=this,i=$(e);i.datetimepicker({format:"yyyy-mm-dd",language:"zh",minView:2,autoclose:!0,endDate:new Date(Date.now()+31536e7)}).on("hide",function(){a.validator.form()}),i.datetimepicker("setStartDate",new Date)}},{key:"initenableBuyExpiry",value:function(){var e=$('[name="enableBuyExpiryTime"]:checked'),a=$('[name="buyable"]:checked'),i=$('[name="buyExpiryTime"]');1==a.val()&&1==e.val()?this.elementAddRules(i,this.getBuyExpiryTimeRules()):this.elementRemoveRules(i),this.validator.form()}},{key:"initExpiryMode",value:function(){var e=$('[name="deadline"]'),a=$('[name="expiryDays"]'),i=$('[name="expiryStartDate"]'),t=$('[name="expiryEndDate"]'),n=$('[name="expiryMode"]:checked').val();switch(this.elementRemoveRules(e),this.elementRemoveRules(a),this.elementRemoveRules(i),this.elementRemoveRules(t),n){case"days":if("end_date"===$('[name="deadlineType"]:checked').val())return this.elementAddRules(e,this.getDeadlineEndDateRules()),void this.validator.form();this.elementAddRules(a,this.getExpiryDaysRules()),this.validator.form();break;case"date":this.elementAddRules(i,this.getExpiryStartDateRules()),this.elementAddRules(t,this.getExpiryEndDateRules()),this.validator.form();break;default:this.validator.form()}}},{key:"getBuyExpiryTimeRules",value:function(){return{required:!0,messages:{required:Translator.trans("course.manage.buy_expiry_time_required_error_hint")}}}},{key:"getExpiryEndDateRules",value:function(){return{required:!0,date:!0,after_date:"#expiryStartDate",messages:{required:Translator.trans("course.manage.expiry_end_date_error_hint")}}}},{key:"getExpiryStartDateRules",value:function(){return{required:!0,date:!0,before_date:"#expiryEndDate",messages:{required:Translator.trans("course.manage.expiry_start_date_error_hint")}}}},{key:"getExpiryDaysRules",value:function(){return{required:!0,positive_integer:!0,max_year:!0,messages:{required:Translator.trans(Translator.trans("course.manage.expiry_days_error_hint"))}}}},{key:"getDeadlineEndDateRules",value:function(){return{required:!0,date:!0,messages:{required:Translator.trans("course.manage.deadline_end_date_error_hint")}}}},{key:"elementAddRules",value:function(e,a){e.rules("add",a)}},{key:"elementRemoveRules",value:function(e){e.rules("remove")}}]),e}())}},["1dd3c6f89866f052a53c"]);